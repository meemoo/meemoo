/*! Meemoo.js - v1 - 2012-09-28
* http://meemoo.org/
* https://github.com/meemoo/meemoo/
* Copyright (c) 2012 Forrest Oliphant; Licensed MIT, AGPL 
*/

(function(a,b,c){"use strict";if(a.Meemoo)return!1;var d={parentWindow:a.opener?a.opener:a.parent?a.parent:c,nodeid:c,sendThroughParent:!0,setInfo:function(a){var c={};a.hasOwnProperty("title")?c.title=a.title:b.title&&(c.title=b.title),a.hasOwnProperty("author")?c.author=a.author:b.getElementsByName("author").length>0&&b.getElementsByName("author")[0].content&&(c.author=b.getElementsByName("author")[0].content),a.hasOwnProperty("description")?c.description=a.description:b.getElementsByName("description").length>0&&b.getElementsByName("description")[0].content&&(c.description=b.getElementsByName("description")[0].content),d.info=c,this.sendParent("info",c);var e=setTimeout(function(){d.stateReadySent||(d.sendParent("stateReady"),d.stateReadySent=!0)},3e3);return d},sendParent:function(a,b){if(this.parentWindow){var c={};c[a]=b?b:a,c.nodeid=d.nodeid,this.parentWindow.postMessage(c,"*")}},send:function(a,b){if(a===c)return;b===c&&(b=a);var d={};d.output=a,d.value=b,this.sendParent("message",d)},set:function(a,b){var c={};c[a]=b,this.sendParent("set",c)},recieve:function(a){var b=a.source===d.parentWindow;for(var c in a.data)d.inputs.hasOwnProperty(c)?d.inputs[c](a.data[c],a):b&&d.frameworkActions.hasOwnProperty(c)&&d.frameworkActions[c](a.data[c],a)},addInput:function(a,b){d.inputs[a]=b.action;var c={};return c.name=a,c.type=b.hasOwnProperty("type")?b.type:"",c.description=b.hasOwnProperty("description")?b.description:"",c.min=b.hasOwnProperty("min")?b.min:"",c.max=b.hasOwnProperty("max")?b.max:"",c.options=b.hasOwnProperty("options")?b.options:"",c["default"]=b.hasOwnProperty("default")?b["default"]:"",b.port!==!1&&this.sendParent("addInput",c),d},stateReadySent:!1,addInputs:function(a){for(var b in a)a.hasOwnProperty(b)&&d.addInput(b,a[b]);return this.sendParent("stateReady"),this.stateReadySent=!0,d},inputs:{},addOutput:function(a,b){return b.connected=!1,d.outputs[a]=b,b.port!==!1&&this.sendParent("addOutput",{name:a,type:b.type}),d},addOutputs:function(a){for(var b in a)a.hasOwnProperty(b)&&d.addOutput(b,a[b]);return d},outputs:{},connected:function(a){return!0},frameworkActions:{connect:function(a){},disconnect:function(a){},getState:function(){var a={};d.sendParent("state",a)},setState:function(a){for(var b in a)d.inputs.hasOwnProperty(b)&&d.inputs[b](a[b])}}};a.addEventListener("message",d.recieve,!1);var e=setTimeout(function(){b.body&&b.getElementById&&(d.info||d.setInfo({}))},2e3),f=function(){if(b.body&&b.getElementById){var a=b.createElement("div");a.innerHTML='<div style="color: #666; background-color:#FFE87C; border: 1px dotted #7d95ff; text-align:center; font-size:15px; padding:20px;">You are looking are a Meemoo module that should be loaded in a Meemoo app.<br />Check out <a href="http://meemoo.org/iframework/">meemoo.org/iframework</a> to see how it works. &lt;3</div>',b.body.appendChild(a)}else setTimeout(f,100)};if(a.name){var g=a.name.split("_"),h=g[1];h=parseInt(h,10),d.nodeid=h}else setTimeout(f,100);a.requestAnimationFrame=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}(),a.Meemoo=d})(window,document);
